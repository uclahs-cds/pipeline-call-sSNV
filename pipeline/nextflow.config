import nextflow.util.SysHelper

manifest {
    mainScript = 'call-sSNV.nf'
    nextflowVersion = '>=20.07.1'
    author = 'Yuan Zhe (Caden) Bugh'
    homePage = 'https://github.com/uclahs-cds/pipeline-call-sSNV'
}

params {
    sample_name = ''
    algorithm = '' // 'somaticsniper' or 'strelka2' or 'mutect2'
    tumor = ''
    normal = ''
    reference = '/path/to/genome.fa'
    output_dir = ''
    output_log_dir = "${params.output_dir}/log"
    save_intermediate_files = true

    // strelka2 options
    exome = false // adds the '--exome' option when running manta and strelka2

    // mutect2 options
    // how much to subtract from the task's allocated memory where the remainder is the Java heap max
    // should not be changed unless task fails for memory related reasons
    gatk_command_mem_diff = 500.MB
    scatter_count = 50
    // the intervals to search for somatic mutations (default is hg38 canonical chromosomes only)
    intervals = "${projectDir}/config/hg38_chromosomes_canonical.list"
}

process {
    executor = 'local'
}

def node_cpus = SysHelper.getAvailCpus()
def node_mem  = SysHelper.getAvailMemory().toString()

if (node_cpus == 2 && node_mem == '3 GB') {
    includeConfig "${projectDir}/config/lowmem.config"
} else if (node_cpus == 72 && node_mem == '136.8 GB') {
    includeConfig "${projectDir}/config/midmem.config"
} else if (node_cpus == 64 && node_mem == '950 GB') {
    includeConfig "${projectDir}/config/execute.config"
} else {
    throw new Exception('ERROR: System resources not as expected, unable to assign resources. Detected cpus: ${node_cpus} and memory: ${node_mem}')
}

docker {
    enabled = true
    runOptions = "-u \$(id -u):\$(id -g)"
}

trace {
    enabled = true
    file = "${params.output_dir}/trace.txt"
}

timeline {
    enabled = true
    file = "${params.output_dir}/timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/report.html"
}
